<!DOCTYPE html>
<html>
  <head>
    <title>Nearby Search</title>
    <style>
        #map {
            height: 80vh; 
            width: 100%; 
        }
        #controls {
            padding: 10px;
            text-align: center;
        }
        .place-btn {
            margin: 5px;
            padding: 10px 18px;
            border-radius: 20px;
            border: none;
            background-color: #e3e3e3;
            cursor: pointer;
            font-size: 16px;
        }
        .place-btn:hover {
            background-color: #d0d0d0;
        }
        .place-btn.active {
            background-color: #4285f4;
            color: white;
        }
    </style>
  </head>
  <body>
    <div id="controls">
        Search Nearby: 
      <button class="place-btn" data-type="restaurant" onclick="searchNearby('restaurant')">Restaurants</button>
      <button class="place-btn" data-type="cafe" onclick="searchNearby('cafe')">Cafes</button>
      <button class="place-btn" data-type="atm" onclick="searchNearby('atm')">ATMs</button>
      <button class="place-btn" data-type="bank" onclick="searchNearby('bank')">Banks</button>
    </div>
    <div id="map"></div>
    <script>
        let map;
        let markers = [];
        async function initMap() {
            const sf = { lat: 37.77497, lng: -122.423673 }; // SF
            map = new google.maps.Map(document.getElementById("map"), {
                center: sf,
                zoom: 14
            });
        }

        function searchNearby(placeType) {
            clearMarkers();
            const service = new google.maps.places.PlacesService(map);
            const request = {
                location: map.getCenter(),
                radius: '5000', // in meters
                type: placeType
            }

            service.nearbySearch(request, (results, status) => {
                results.forEach((place) => {
                    const marker = new google.maps.Marker({
                        map,
                        position: place.geometry.location,
                        title: place.name,
                    });
                    markers.push(marker);
                    const infoWindow = new google.maps.InfoWindow({
                        content: `<h3>${place.name}</h3><br>${place.vicinity}`,
                    });
                    marker.addListener("click", () => {
                        infoWindow.open(map, marker);
                    });
                })
            })
        }

        function clearMarkers() {
            markers.forEach((marker) => marker.setMap(null));
            markers = [];
        }


    </script>

    <script defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD02SGgtjMrBmRLSR79u81NoJrWVTGgqak&callback=initMap&libraries=places"></script>
    </body>
</html>